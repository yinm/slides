<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta name="theme-color" content="#3498db"><meta name="viewport" content="width=device-width,initial-scale=1"><title>20190725-vuejs-application-testing-with-why</title><meta property="og:title" content="20190725-vuejs-application-testing-with-why"><meta property="og:type" content="article"><meta property="og:url" content="https://yinm.github.io/slides/20190725-vuejs-application-testing-with-why"><meta property="og:site_name" content="yinm's slides"><link href="vendor.6.ba9b90228992c49da696.css" rel="stylesheet"><link href="main.3.9ebde3d1e015d54dfa8e.css" rel="stylesheet"></head><body><div id="root"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="btn-sidebar" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg><article id="webslides"><section class="aligncenter title"><h1>「なぜから始める、現場のVue.jsアプリの自動テスト」</h1><br><p>@ 2019.07.25 <a href="https://vuejs-meetup.connpass.com/event/138117/">Vue.js v-tokyo Meetup #10</a></p></section><section class="aligncenter"><h1>About me</h1></section><section class="aligncenter fullscreen"><div class="card-50"><figure><img src="9a57f767cfb679fabff747682cf186c1.webp"></figure><div class="flex-content"><h1>Yusuke Iinuma</h1><br><ul class="profile-list"><li>Working at <strong>GMO Pepabo, Inc.</strong></li><li>A staff of <strong>Vue.js Japan User Group</strong></li></ul><div class="sns-list"><a href="https://github.com/yinm" target="_blank"><i class="fab fa-github"></i></a><a href="https://twitter.com/_yinm_" target="_blank"><i class="fab fa-twitter"></i></a><a href="https://yinm.info/" target="_blank"><i class="fas fa-home"></i></a></div></div></div></section><section class="aligncenter"><h1>おしながき</h1></section><section class="aligncenter agenda"><ul><li>発表のゴール</li><li>現場のVue.jsアプリ</li><li>なぜテストを書くのか</li><li>テストを書く理由と対応</li><li>投資対効果のいいテストをする指針</li><li>まとめ</li></ul></section><section class="aligncenter agenda"><ul><li><strong>発表のゴール</strong></li><li>現場のVue.jsアプリ</li><li>なぜテストを書くのか</li><li>テストを書く理由と対応</li><li>投資対効果のいいテストをする指針</li><li>まとめ</li></ul></section><section class="aligncenter target-listener"><h1>発表の対象者</h1><br><br><br><p>テスティングフレームワークなどのツールの使い方はわかるが、</p><p>実際の開発でどのように使えばいいのか悩んでる人</p><br><br><br><h2>🎊 現場に合ったテストについて考えるきっかけになれば 🎊</h2></section><section class="aligncenter"><h1>話すこと</h1><br><br><br><ul><li>テストはなぜ必要なのか</li><li>テストするときの指針の紹介</li><li>現場で行ってるテストの事例</li></ul></section><section class="aligncenter"><h1>話さないこと</h1><br><br><br><ul><li>コードレベルでのテスト実装方法</li></ul></section><section class="aligncenter agenda"><ul><li>発表のゴール</li><li><strong>現場のVue.jsアプリ</strong></li><li>なぜテストを書くのか</li><li>テストを書く理由と対応</li><li>投資対効果のいいテストをする指針</li><li>まとめ</li></ul></section><section class="aligncenter fullscreen"><img src="300b2ef48e3ea2379d98431a109e0cd2.webp"></section><section class="aligncenter"><h1><a href="https://colorme-repeat.jp/">カラーミーリピート</a></h1><br><br><br><ul><li>Vue Fes Japan 2018でも話されてる<ul class="slide-link"><li><a href="https://speakerdeck.com/tsuchikazu/vue-component-test">1年間単体テストを書き続けた現場から送る Vue Component のテスト / Vue Component Test</a></li></ul></li><li>Vue.jsアプリの規模としては、SFCが200個以上 (2019/07時点)</li></ul></section><section class="aligncenter agenda"><ul><li>発表のゴール</li><li>現場のVue.jsアプリ</li><li><strong>なぜテストを書くのか</strong></li><li>テストを書く理由と対応</li><li>投資対効果のいいテストをする指針</li><li>まとめ</li></ul></section><section class="aligncenter"><h1>そもそも、テストコードは絶対ないとダメなもの？</h1></section><section class="aligncenter"><h1>すべてをテストするわけではない</h1><br><br><br><ul><li>テストコードは、サービスのユーザーに直接的な価値を生み出すものではない</li><li>使い捨てのコードなら、テストを書かない方が早く作業を終えられる</li></ul></section><section class="aligncenter"><h1>とはいえ、自分が担当するサービスにテストがなかったら</h1></section><section class="aligncenter"><h1>「<strong>えっ？それは大変そう...</strong>」</h1></section><section class="aligncenter"><h1>この差を考えると、</h1><h1>自分がなぜテストを必要と思っているかわかりそう</h1></section><section class="aligncenter"><h1>自分が考えたテストを書く理由</h1><br><br><br><ul><li>人に依存せずに繰り返し動作検証したいため</li><li>生きた仕様書(挙動・見た目)が欲しいため</li></ul></section><section class="aligncenter agenda"><ul><li>発表のゴール</li><li>現場のVue.jsアプリ</li><li>なぜテストを書くのか</li><li><strong>テストを書く理由と対応</strong></li><li>投資対効果のいいテストをする指針</li><li>まとめ</li></ul></section><section class="aligncenter"><h1>人に依存せずに繰り返し動作検証したいため</h1></section><section class="aligncenter"><ul><li>人(スキル・体調)によってどこまでテストするかのばらつきを無くしたい</li><li>開発フローに組み込むことで、リリース前に意図しない挙動・見た目を検知したい</li></ul></section><section class="aligncenter"><h1>対応</h1></section><section class="aligncenter"><ul><li>テストを書く</li><li>CIを整備する</li></ul></section><section class="aligncenter"><h1>生きた仕様書(挙動・見た目)が欲しいため</h1></section><section class="aligncenter"><ul><li>開発対象の理解を補助したい<ul><li>ソースコードだけではなく、テストコードがあることで内容を理解しやすくなる</li></ul></li><li>見た目に関するドキュメントがあると、コミュニケーションがスムーズになる<ul><li>機能追加時に、関連する既存機能のUIをさっと確認できる</li></ul></li></ul></section><section class="aligncenter"><h1>対応</h1></section><section class="aligncenter"><ul><li>BDDのように、テストケースで要求仕様で言語化する</li><li>Visual Regression Testingを導入する</li></ul></section><section class="aligncenter"><ul><li>BDDのように、テストケースで要求仕様で言語化する</li><li><strong>Visual Regression Testing</strong>を導入する</li></ul></section><section class="aligncenter"><img src="ac512d200d271b6f16043b56024bbe21.webp"></section><section class="aligncenter large-image"><img src="d4bdada97c3d37ded137c296569a5a8f.webp"></section><section class="aligncenter large-image"><img src="a06dfda6e5ecd0d3524043a383d1f62f.webp"></section><section class="aligncenter"><h1>Visual Regression Testing の よいところ</h1><br><br><br><ul><li>見た目の検証の安心感が増す<ul><li>Storybookを使うことで、UIのエッジケースも検証できる</li><li><a href="https://jestjs.io/docs/ja/expect#tocontainitem"><code>.toContain()</code></a>などで検証するのに比べて、表示位置やスタイルも検証できる</li></ul></li><li>デザイナーとの協業がしやすい<ul><li>テストコードをデザイナーが直すのは難しいが、VRTなら見た目で可否を判断できる</li></ul></li><li>Storybookが拡充できるので、見た目のドキュメントができる</li></ul></section><section class="aligncenter"><h1>Visual Regression Testing の 注意点</h1><br><br><br><ul><li>誤検知しがちなテストにしない (テストの信頼性が下がって、割れ窓になってしまう)<ul><li>インテグレーションテスト中にスクリーンショットを撮るのをやめた</li></ul></li><li>アニメーションなど動きがあるものはテストできない<ul><li>目視で確認</li></ul></li><li>チームメンバーにStoryを書いてもらう努力 (チームで使うツールにならないと廃れる)<ul><li>自分が手本になるStoryを書く・レビューする (VRTの環境整備していくぞという気概)</li></ul></li></ul></section><section class="aligncenter agenda"><ul><li>発表のゴール</li><li>現場のVue.jsアプリ</li><li>なぜテストを書くのか</li><li>テストを書く理由と対応</li><li><strong>投資対効果のいいテストをする指針</strong></li><li>まとめ</li></ul></section><section class="aligncenter large-image"><img src="b161c9fbfad5a83e2adc8a69b9771ac9.webp"></section><section class="aligncenter"><h1><a href="https://twitter.com/kentcdodds/status/960723172591992832">The Testing Trophy</a></h1><br><br><br><ul><li><a href="https://kentcdodds.com/about/">Kent C. Dodds</a>が提唱<ul><li>元PayPalのエンジニアで、現在はJSテストなどの講師</li></ul></li><li>JSアプリのテストの種類ごとの投資対効果のガイド<ul><li>テストの種類ごとの投資対効果で面積の広さが決まる (広いほど効果が高い)</li></ul></li><li>ただし、テストの種類ごとの割合は厳密なルールではない<ul><li>前述の割合は一般的なものなので、<a href="https://twitter.com/kentcdodds/status/960723175066681344">現場によって多少変化してもよい</a></li></ul></li></ul></section><section class="aligncenter"><h2><a href="https://martinfowler.com/bliki/TestPyramid.html">TestPyramid</a>とは何が違う？ 🤔</h2><img src="9ebe8a6842d74d7c2e67721f5b087295.webp"></section><section class="aligncenter"><h1>The Testing Trophy の よいところ</h1><br><br><br><ul><li>テストがもたらす安心感という指標を追加<ul><li>TestPyramidは、実行速度・実装コストのみ</li></ul></li><li>JSアプリのテストに特化<ul><li>テストの種類に、Static(Linter・静的型解析)が追加</li></ul></li></ul></section><section class="aligncenter large-image"><img src="41ffe09d32d6dfd90d60406b478e818b.webp"></section><section class="aligncenter"><h2>これを指針に、Vue.jsアプリのテストを考えてみるとよさそう！</h2></section><section class="aligncenter"><h1>自分の現場アプリを、</h1><h1>The Testing Trophyにあてはめて見直してみる</h1></section><section class="aligncenter"><h1>Static</h1><h2>(Linter・静的型解析を使って、typoや型エラーをチェック)</h2></section><section class="aligncenter"><ul><li>LinterはESLintを導入している</li><li>静的型解析は導入していない (TypeScriptの導入は検討中)</li></ul></section><section class="aligncenter"><h1>Unit</h1><h2>(単一の処理の振る舞いをチェック)</h2></section><section class="aligncenter"><ul><li>Store</li><li>Validation rules</li><li>Filters</li></ul></section><section class="aligncenter"><h1>Integration</h1><h2>(複数の処理を組み合わせた時の振る舞いをチェック)</h2></section><section class="aligncenter"><ul><li>SFCの動作<ul><li>フォーム入力 ➡️ バリデーション ➡️ 結果検証</li></ul></li><li>Visual Regression Testing<ul><li>Props, Storeからデータを受け取る ➡️ コンポーネントの表示</li></ul></li></ul></section><section class="aligncenter"><h1>E2E</h1><h2>(アプリケーションを動かして、シナリオ通りに動作するかをチェック)</h2></section><section class="aligncenter"><ul><li>今のアプリでは何もしてない</li><li>クリティカルな部分(e.g. checkout)にはテストがあると安心感が増してよさそう</li><li>しかし現状だと、VRTの拡充の方が投資対効果高いと考えて、後回しに</li><li>(もし、こんな感じでE2Eやるとよかったよ！がある方は懇親会でお話させてください🙏)</li></ul></section><section class="aligncenter"><h1>これから改善したいこと</h1></section><section class="aligncenter"><ul><li>静的型解析の導入 (型エラーをチェックできる)</li><li>Storybookを拡充する (VRTのカバー範囲を増やす)</li></ul></section><section class="aligncenter agenda"><ul><li>発表のゴール</li><li>現場のVue.jsアプリ</li><li>なぜテストを書くのか</li><li>テストを書く理由と対応</li><li>投資対効果のいいテストをする指針</li><li><strong>まとめ</strong></li></ul></section><section class="aligncenter"><ul><li>自分なりのなぜテストを書くのかを説明<ul><li>人に依存せずに繰り返し動作検証したいため</li><li>生きた仕様書(挙動・見た目)が欲しいため</li></ul></li><li>投資対効果のいいテストを書く指針として、The Testing Trophyの紹介</li><li>指針に沿って現場のテストを見直し</li></ul><br><br><br><h1>現場のVue.jsアプリのテストをなぜから考えてみてください！</h1></section></article></div><script type="text/javascript" src="runtime.ac4bdb71e57814600ded.bundle.js"></script><script type="text/javascript" src="vendor.6.ba9b90228992c49da696.bundle.js"></script><script type="text/javascript" src="main.3.9ebde3d1e015d54dfa8e.bundle.js"></script></body></html>