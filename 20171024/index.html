<html>
<head>
  <link rel="stylesheet" href="./dist/talkie.min.css">
  <link rel="stylesheet" href="./dist/talkie-default.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/monokai_sublime.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<script layout="cover" invert type="text/x-markdown"
  backface="./image/my-icon.jpg" backface-filter="brightness(.4)">
# ゆるく始めるPuppet

* 2017.10.24 - 飯沼 佑典 ([yinm](https://github.com/yinm))
</script>

<script layout type="text/x-markdown">
## この発表のターゲットは誰？
* Puppetを読み書きできるようになりたいけれど、<br>どこから手をつけたらいいかわからない人
</script>

<script layout type="text/x-markdown">
## ゴールはどこ？
* Puppetのmanifestsのなんとなくの読み方がわかる
* 実際に手を動かして学習できる方法がわかる
</script>

<script layout type="text/x-markdown">
## おしながき
* ・Puppetとは
* ・Puppetの記法を学ぶ
* ・Puppetの学習方法を知る
* ・まとめ
</script>

<script layout type="text/x-markdown">
## Puppetとは
</script>

<script layout type="text/x-markdown">
* ・ システム管理を自動で行うためのツール
* ・ マルチプラットフォームで使うことができる
* ・ [agent/master構成](https://puppet.com/docs/puppet/5.3/architecture.html#the-agentmaster-architecture)で動作する (stand aloneでも動作する)
* 参考: [puppetlabs/puppet](https://github.com/puppetlabs/puppet)
</script>

<script layout type="text/x-markdown">
## Puppetの記法を学ぶ
</script>

<script layout type="text/x-markdown">
### Level1
### システムの状態を記述できるようになる
</script>

<script layout type="text/x-markdown">
* システムの状態を最小の単位である、**Resource Type** を使う
* Resource Typeによって、指定できるattributesが異なる
* Resource Typeの詳細は、[https://puppet.com/docs/puppet/latest/type.html](https://puppet.com/docs/puppet/latest/type.html)
</script>

<script layout type="text/x-markdown">
* [fileを使った例](https://gist.github.com/yinm/93f907d5db936e31205514c47bf262fd)
</script>

<script layout type="text/x-markdown">
### Level2
### 依存関係を解決できるようになる
</script>

<script layout type="text/x-markdown">
### 抱えている問題
* Puppetのmanifestの適用順は、ファイルの先頭から順番に実行されるとは限らない
* そのため、開発者が意図した順にmanifestが適用されないかもしれない
* [依存関係が解決できていない例](https://gist.github.com/yinm/4c89560d9746dbda775fc737e0902a09)
</script>

<script layout type="text/x-markdown">
### 解決するには
* dependency relationship(`require`, `->`)を指定する
* [依存関係が解決できる例](https://gist.github.com/yinm/4350b302cdd54a0f804c6327739d0cbe)
</script>

<script layout type="text/x-markdown">
### 関連事項
* 設定ファイルの変更を検知して、サービスを再起動したい場合には、refresh relationship(`subscribe`、`~>`)を指定する
</script>

<!-- TODO: 図を作る-->
<script layout type="text/x-markdown">
### Puppetの記法のOverview
![puppet_overview](./image/puppet_overview.png)
</script>

<script layout type="text/x-markdown">
### Resource (概要編)
</script>

<script layout type="text/x-markdown">
* システムの状態を宣言する最小の単位のこと
* `file`や`service`など、Resourceの具体的な種類のことを、**Resource Types**と呼ぶ
* Resource Typesによって、指定できる状態(attributes)が異なる
* Resource Typesの詳細は、[https://puppet.com/docs/puppet/latest/type.html](https://puppet.com/docs/puppet/latest/type.html)
</script>

<script layout="code" invert type="text/x-markdown">
### Resourceの記法

```puppet
resouce types { resource title
  attribute1 => value1,
  attribute2 => value2,
  ...
}
```
</script>

<script layout type="text/x-markdown">
### Resource (実践編)
</script>


<script layout="code" invert type="text/x-markdown">
### Resourceの記法 (`file`の例)

```puppet
file { '/etc/passwd':
  owner => 'root',
  group => 'root',
  mode  => '0644',
}
```
</script>

<script layout type="text/x-markdown">
### Class
</script>

<script layout type="text/x-markdown">
* Resourceをグルーピングして、再利用しやすくするための記法
</script>

<script layout="code" invert type="text/x-markdown">
### Classの記法

```puppet
class baz {
  file { '/etc/passwd':
    owner => 'root',
    group => 'root',
    mode  => '0644',
  }

  notify {'this is Class baz': }
}

# classの呼び出し
include baz
```
</script>

<script layout type="text/x-markdown">
### Module
</script>

<script layout type="text/x-markdown">
* Classのファイルをひとまとめに管理するための仕組み
* また、Classに関連するテンプレートなどをオートロードできる仕組みも備えている
* Moduleは、**ディレクトリ構成**で表現する (記法があるわけではない)
* 使用できるディレクトリ構成 [https://puppet.com/docs/puppet/latest/modules_fundamentals.html](https://puppet.com/docs/puppet/latest/modules_fundamentals.html)
</script>

<script layout="code" invert type="text/x-markdown">
### Moduleのディレクトリ構成

```
modules
├── ntp
│   ├── files
│   │   └── ntp.conf
│   ├── manifests
│   │   ├── config.pp
│   │   ├── init.pp
│   │   ├── install.pp
│   │   └── service.pp
│   ├── spec
│   │   ├── classes
│   │   │   └── init_spec.rb
│   │   └── spec_helper.rb
│   └── templates
│       └── ntp.conf.epp
```

</script>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script src="./dist/talkie.min.js"></script>
<script>Talkie();</script>
</body>
</html>
